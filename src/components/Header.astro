---
const currentPath = Astro.url.pathname;

const isActive = (href: string) => {
  if (href === "/" && currentPath === "/") return true;
  if (href !== "/" && currentPath.startsWith(href)) return true;
  return false;
};

const navLinks = [
  { href: "/", label: "HOME" },
  { href: "/blog", label: "BLOG" },
  { href: "/projects", label: "PROJECTS" },
];
---

<header class="bg-bg-primary/85 backdrop-blur-sm sticky top-0 z-50">
  <nav class="max-w-prose mx-auto px-[clamp(16px,4vw,48px)] py-md flex items-center justify-end gap-6">
    <!-- Mobile hamburger -->
    <button
      id="menu-toggle"
      class="md:hidden text-text-primary hover:text-accent transition-colors p-1 mr-auto"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <!-- All nav items aligned right -->
    {navLinks.map(({ href, label }) => (
      <a
        href={href}
        class={`hidden md:block text-[0.75rem] font-bold tracking-widest uppercase ${
          isActive(href)
            ? "text-accent"
            : "text-text-primary hover:text-accent"
        } transition-colors`}
      >
        {label}
      </a>
    ))}
    <button
      id="search-button"
      class="text-[0.75rem] font-bold tracking-widest uppercase text-text-primary hover:text-accent transition-colors"
      aria-label="Search"
    >
      SEARCH
    </button>
    <button
      id="debug-toggle"
      class="text-[0.75rem] font-bold tracking-widest uppercase text-text-primary hover:text-accent transition-colors hidden sm:block"
      aria-label="Toggle debug mode"
      aria-pressed="false"
    >
      DEBUG
    </button>
    <button
      id="theme-toggle"
      class="text-[0.75rem] font-bold tracking-widest uppercase text-text-primary hover:text-accent transition-colors"
      aria-label="Toggle theme"
    >
      LIGHT
    </button>
  </nav>

  <!-- Mobile menu panel -->
  <div id="mobile-menu" class="md:hidden hidden border-t border-[var(--color-border)]">
    <div class="max-w-prose mx-auto px-[clamp(16px,4vw,48px)] py-md flex flex-col gap-4">
      {navLinks.map(({ href, label }) => (
        <a
          href={href}
          class={`text-xs font-bold tracking-widest uppercase ${
            isActive(href)
              ? "text-accent"
              : "text-text-primary hover:text-accent"
          } transition-colors`}
        >
          {label}
        </a>
      ))}
      <button
        id="debug-toggle-mobile"
        class="text-xs font-bold tracking-widest uppercase text-text-primary hover:text-accent transition-colors text-left"
        aria-label="Toggle debug mode"
      >
        DEBUG
      </button>
    </div>
  </div>
</header>

<script>
  // Theme toggle
  function toggleTheme() {
    const current = document.documentElement.dataset.theme || 'light';
    const next = current === 'light' ? 'dark' : 'light';
    document.documentElement.dataset.theme = next;
    localStorage.setItem('theme', next);
    updateThemeButton(next);
  }

  function updateThemeButton(theme: string) {
    const btn = document.getElementById('theme-toggle');
    if (btn) btn.textContent = theme === 'dark' ? 'DARK' : 'LIGHT';
  }

  // Debug toggle
  function toggleDebug() {
    const current = document.documentElement.dataset.debug || 'off';
    const next = current === 'on' ? 'off' : 'on';
    document.documentElement.dataset.debug = next;
    localStorage.setItem('debug-borders', next);
    updateDebugButtons(next);
  }

  function updateDebugButtons(state: string) {
    const pressed = state === 'on' ? 'true' : 'false';
    document.getElementById('debug-toggle')?.setAttribute('aria-pressed', pressed);
    document.getElementById('debug-toggle-mobile')?.setAttribute('aria-pressed', pressed);
  }

  // Mobile menu toggle
  function toggleMenu() {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('menu-toggle');
    if (!menu || !btn) return;
    const isOpen = !menu.classList.contains('hidden');
    menu.classList.toggle('hidden');
    btn.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
  }

  // Search modal
  function openSearch() {
    const modal = document.getElementById('search-modal');
    if (modal) (modal as HTMLDialogElement).showModal();
  }

  // Initialize button states
  const theme = document.documentElement.dataset.theme || 'light';
  updateThemeButton(theme);
  const debug = document.documentElement.dataset.debug || 'off';
  updateDebugButtons(debug);

  // Attach event listeners
  document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);
  document.getElementById('debug-toggle')?.addEventListener('click', toggleDebug);
  document.getElementById('debug-toggle-mobile')?.addEventListener('click', toggleDebug);
  document.getElementById('search-button')?.addEventListener('click', openSearch);
  document.getElementById('menu-toggle')?.addEventListener('click', toggleMenu);
</script>

